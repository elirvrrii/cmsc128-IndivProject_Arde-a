<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="login-design.css">
</head>
<body>
    <div class="container">
        <div class="row">
            <h2>Welcome, placeholder!</h2>
            <div id="profile-information">
            </div>
            <hr>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getDatabase, ref, push, set, update, remove, onChildAdded } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

        const firebaseConfig = { // firebase configuration
            apiKey: "AIzaSyCfxNU7BbmtvNlTBdEFa4JEq8MbnT5r41Q",
            authDomain: "what-to-do-2fcc7.firebaseapp.com",
            databaseURL: "https://what-to-do-2fcc7-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "what-to-do-2fcc7",
            storageBucket: "what-to-do-2fcc7.appspot.com",
            messagingSenderId: "982422793450",
            appId: "1:982422793450:web:9339738576ddf5837ebb93"
        };

        const app = initializeApp(firebaseConfig); // initializes firebase and grabs the db
        const db = getDatabase();

        const userName = localStorage.getItem("userLoginName");
        const userEmail = localStorage.getItem("userLoginEmail");   
        const userPassword = localStorage.getItem("userLoginPassword");

        if(!userEmail){
            window.location.href = "login.html";
        }else{
            document.querySelector("h2").innerText = `Welcome, ${userName}!`;
            document.getElementById("profile-information").innerHTML = `
                <h3>Information</h3>
                <button id="editBtn">Edit</button><br>
                <p><strong>Name:</strong> ${userName}</p>
                <p><strong>Email:</strong> ${userEmail}</p>
            `;
            document.getElementById("editBtn").addEventListener("click", editAccount);
        }

        function editAccount(){
            const editDiv = document.getElementById("profile-information");
            editDiv.innerHTML = `
                <h3>Edit Information</h3>
                <form id="edit-form">
                    <label for="editName">Name:</label>
                    <input type="text" id="editName" value="${userName}" required><br>

                    <label for="editEmail">Email:</label>
                    <input type="email" id="editEmail" value="${userEmail}" required><br>

                    <label for="editPassword">Password:</label>
                    <input type="password" id="editPassword" value="${userPassword}" required><br>

                    <button type="submit" id="saveBtn">Save</button>
                    <button type="button" id="cancelBtn">Cancel</button>
                </form>
            `;

            document.getElementById("edit-form").addEventListener("submit", (e) => {
                e.preventDefault();
                const updatedUser = {
                    accountName: document.getElementById("editName").value,
                    accountEmail: document.getElementById("editEmail").value,
                    accountPassword: document.getElementById("editPassword").value
                };
                update(ref(db, 'accounts/' + userEmail.replace('.', '_')), updatedUser);

                localStorage.setItem("userLoginName", updatedUser.accountName);
                localStorage.setItem("userLoginEmail", updatedUser.accountEmail);
                localStorage.setItem("userLoginPassword", updatedUser.accountPassword);

                window.location.reload();

            });

            document.getElementById("cancelBtn").addEventListener("click", (e) => {
                window.location.reload();
            });
        }

    </script>
</body>
</html>